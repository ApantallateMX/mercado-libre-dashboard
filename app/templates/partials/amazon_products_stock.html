{% if no_account or error %}
<div class="flex flex-col items-center justify-center py-12 text-center">
    <p class="text-orange-500 font-semibold">{{ error or 'Sin cuenta Amazon conectada' }}</p>
    {% if no_account %}
    <a href="/auth/amazon/connect" class="mt-3 bg-orange-500 text-white px-4 py-2 rounded-lg text-sm">Conectar Amazon</a>
    {% endif %}
</div>
{% else %}

{% set total_urgentes = sin_stock|length + stock_bajo|length + restock_urgente|length %}

{% if total_urgentes == 0 %}
<!-- Todo OK -->
<div class="bg-white rounded-xl shadow p-10 text-center">
    <div class="text-4xl mb-3">âœ…</div>
    <h3 class="text-lg font-bold text-gray-700 mb-1">Sin alertas de stock</h3>
    <p class="text-gray-400 text-sm">Tu inventario FBA estÃ¡ en buen estado.</p>
</div>

{% else %}

<!-- â”€â”€â”€ SIN STOCK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
{% if sin_stock %}
<div class="bg-white rounded-xl shadow overflow-hidden mb-4 border-l-4 border-red-500">
    <div class="px-4 py-3 bg-red-50 flex items-center justify-between border-b border-red-100">
        <div class="flex items-center gap-2">
            <span class="text-lg">ðŸ”´</span>
            <div>
                <h3 class="text-sm font-bold text-red-800">Sin Stock en FBA</h3>
                <p class="text-xs text-red-600">Ventas perdidas activamente â€” reabastece AHORA</p>
            </div>
        </div>
        <span class="px-3 py-1 bg-red-500 text-white text-xs font-bold rounded-full">{{ sin_stock|length }} SKUs</span>
    </div>
    <div class="overflow-x-auto">
        <table class="w-full text-sm">
            <thead class="bg-red-50/50">
                <tr class="text-xs text-red-700 text-left border-b border-red-100">
                    <th class="py-2 px-4 font-medium">Producto / SKU</th>
                    <th class="py-2 px-3 font-medium text-right">Ventas 30d</th>
                    <th class="py-2 px-3 font-medium text-right hidden md:table-cell">Vel./dÃ­a</th>
                    <th class="py-2 px-3 font-medium text-right hidden md:table-cell">Entrante</th>
                    <th class="py-2 px-3 font-medium text-center">AcciÃ³n</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-red-50">
                {% for item in sin_stock %}
                <tr class="hover:bg-red-50/30 transition">
                    <td class="py-3 px-4">
                        <p class="text-sm font-medium text-gray-800 truncate max-w-[200px] md:max-w-[350px]">{{ item.title }}</p>
                        <div class="flex items-center gap-2 mt-0.5">
                            <p class="text-xs text-gray-400">{{ item.sku }}</p>
                            {% if item.asin %}<p class="text-xs text-orange-400">{{ item.asin }}</p>{% endif %}
                        </div>
                    </td>
                    <td class="py-3 px-3 text-right">
                        <span class="text-sm font-bold text-red-600">{{ item.units_30d }}</span>
                    </td>
                    <td class="py-3 px-3 text-right hidden md:table-cell">
                        <span class="text-xs text-gray-600">{{ item.vel_dia }}/d</span>
                    </td>
                    <td class="py-3 px-3 text-right hidden md:table-cell">
                        {% if item.inbound > 0 %}
                        <span class="text-xs text-blue-500 font-medium">+{{ item.inbound }}</span>
                        {% else %}
                        <span class="text-xs text-gray-300">0</span>
                        {% endif %}
                    </td>
                    <td class="py-3 px-3 text-center">
                        <a href="{{ item.sc_url }}" target="_blank"
                           class="inline-block px-3 py-1 bg-red-500 hover:bg-red-600 text-white text-xs font-medium rounded-lg transition">
                            Seller Central â†’
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

<!-- â”€â”€â”€ STOCK BAJO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
{% if stock_bajo %}
<div class="bg-white rounded-xl shadow overflow-hidden mb-4 border-l-4 border-orange-400">
    <div class="px-4 py-3 bg-orange-50 flex items-center justify-between border-b border-orange-100">
        <div class="flex items-center gap-2">
            <span class="text-lg">ðŸŸ </span>
            <div>
                <h3 class="text-sm font-bold text-orange-800">Stock Bajo (&lt; 10 uds)</h3>
                <p class="text-xs text-orange-600">Riesgo de agotamiento en dÃ­as</p>
            </div>
        </div>
        <span class="px-3 py-1 bg-orange-400 text-white text-xs font-bold rounded-full">{{ stock_bajo|length }} SKUs</span>
    </div>
    <div class="overflow-x-auto">
        <table class="w-full text-sm">
            <thead class="bg-orange-50/50">
                <tr class="text-xs text-orange-700 text-left border-b border-orange-100">
                    <th class="py-2 px-4 font-medium">Producto / SKU</th>
                    <th class="py-2 px-3 font-medium text-right">FBA Disp.</th>
                    <th class="py-2 px-3 font-medium text-right">Vel./dÃ­a</th>
                    <th class="py-2 px-3 font-medium text-right hidden md:table-cell">DÃ­as hasta 0</th>
                    <th class="py-2 px-3 font-medium hidden md:table-cell">RecomendaciÃ³n</th>
                    <th class="py-2 px-3 font-medium text-center">AcciÃ³n</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-orange-50">
                {% for item in stock_bajo %}
                <tr class="hover:bg-orange-50/30 transition">
                    <td class="py-3 px-4">
                        <p class="text-sm font-medium text-gray-800 truncate max-w-[200px] md:max-w-[280px]">{{ item.title }}</p>
                        <p class="text-xs text-gray-400">{{ item.sku }}</p>
                    </td>
                    <td class="py-3 px-3 text-right">
                        <span class="text-sm font-bold text-orange-600">{{ item.fulfillable }}</span>
                    </td>
                    <td class="py-3 px-3 text-right">
                        <span class="text-xs text-gray-600">{{ item.vel_dia }}/d</span>
                    </td>
                    <td class="py-3 px-3 text-right hidden md:table-cell">
                        {% if item.dias_hasta_0 is not none %}
                        <span class="px-2 py-0.5 rounded-full text-xs font-bold
                            {% if item.dias_hasta_0 <= 7 %}bg-red-100 text-red-700
                            {% else %}bg-yellow-100 text-yellow-700{% endif %}">
                            {{ item.dias_hasta_0 }}d
                        </span>
                        {% else %}
                        <span class="text-xs text-gray-300">â€”</span>
                        {% endif %}
                    </td>
                    <td class="py-3 px-3 hidden md:table-cell">
                        <p class="text-xs text-gray-500">{{ item.recomendacion }}</p>
                    </td>
                    <td class="py-3 px-3 text-center">
                        <a href="{{ item.sc_url }}" target="_blank"
                           class="inline-block px-3 py-1 bg-orange-400 hover:bg-orange-500 text-white text-xs font-medium rounded-lg transition">
                            Ver â†’
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

<!-- â”€â”€â”€ RESTOCK URGENTE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
{% if restock_urgente %}
<div class="bg-white rounded-xl shadow overflow-hidden border-l-4 border-yellow-400">
    <div class="px-4 py-3 bg-yellow-50 flex items-center justify-between border-b border-yellow-100">
        <div class="flex items-center gap-2">
            <span class="text-lg">ðŸŸ¡</span>
            <div>
                <h3 class="text-sm font-bold text-yellow-800">Restock Urgente (&lt; 14 dÃ­as supply)</h3>
                <p class="text-xs text-yellow-600">Basado en velocidad de ventas â€” planifica envÃ­o FBA</p>
            </div>
        </div>
        <span class="px-3 py-1 bg-yellow-400 text-white text-xs font-bold rounded-full">{{ restock_urgente|length }} SKUs</span>
    </div>
    <div class="overflow-x-auto">
        <table class="w-full text-sm">
            <thead class="bg-yellow-50/50">
                <tr class="text-xs text-yellow-700 text-left border-b border-yellow-100">
                    <th class="py-2 px-4 font-medium">Producto / SKU</th>
                    <th class="py-2 px-3 font-medium text-right">FBA Disp.</th>
                    <th class="py-2 px-3 font-medium text-right">Vel./dÃ­a</th>
                    <th class="py-2 px-3 font-medium text-right">DÃ­as Supply</th>
                    <th class="py-2 px-3 font-medium text-right hidden md:table-cell">Entrante</th>
                    <th class="py-2 px-3 font-medium text-right hidden md:table-cell">Sugerido enviar</th>
                    <th class="py-2 px-3 font-medium text-center">AcciÃ³n</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-yellow-50">
                {% for item in restock_urgente %}
                <tr class="hover:bg-yellow-50/30 transition">
                    <td class="py-3 px-4">
                        <p class="text-sm font-medium text-gray-800 truncate max-w-[200px] md:max-w-[280px]">{{ item.title }}</p>
                        <p class="text-xs text-gray-400">{{ item.sku }}</p>
                    </td>
                    <td class="py-3 px-3 text-right">
                        <span class="text-sm font-bold text-gray-700">{{ item.fulfillable }}</span>
                    </td>
                    <td class="py-3 px-3 text-right">
                        <span class="text-xs text-gray-600">{{ item.vel_dia }}/d</span>
                    </td>
                    <td class="py-3 px-3 text-right">
                        <span class="px-2 py-0.5 rounded-full text-xs font-bold
                            {% if item.dias_supply <= 7 %}bg-red-100 text-red-700
                            {% else %}bg-yellow-100 text-yellow-700{% endif %}">
                            {{ item.dias_supply }}d
                        </span>
                    </td>
                    <td class="py-3 px-3 text-right hidden md:table-cell">
                        <span class="text-xs {% if item.inbound > 0 %}text-blue-500 font-medium{% else %}text-gray-300{% endif %}">
                            {{ item.inbound }}
                        </span>
                    </td>
                    <td class="py-3 px-3 text-right hidden md:table-cell">
                        {% if item.sugeridas > 0 %}
                        <span class="text-sm font-bold text-[#FF9900]">{{ item.sugeridas }}</span>
                        <span class="text-xs text-gray-400"> uds</span>
                        {% else %}
                        <span class="text-xs text-gray-400">Ya en camino</span>
                        {% endif %}
                    </td>
                    <td class="py-3 px-3 text-center">
                        <a href="{{ item.sc_url }}" target="_blank"
                           class="inline-block px-3 py-1 bg-yellow-400 hover:bg-yellow-500 text-white text-xs font-medium rounded-lg transition">
                            Ver â†’
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endif %}

{% endif %}

{% endif %}
