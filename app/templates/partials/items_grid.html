<div class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-4">
    {% for item in items %}
    <div class="bg-white rounded-lg shadow overflow-hidden">
        {% if item.body and item.body.thumbnail %}
        <img src="{{ item.body.thumbnail }}" alt="{{ item.body.title }}" class="w-full h-40 object-cover">
        {% else %}
        <div class="w-full h-40 bg-gray-200 flex items-center justify-center">
            <span class="text-gray-400">Sin imagen</span>
        </div>
        {% endif %}
        <div class="p-4">
            <h3 class="font-medium text-gray-800 text-sm mb-2 line-clamp-2">
                {{ item.body.title if item.body else item.id }}
            </h3>
            {% if item.body %}
            <div class="flex justify-between items-center mb-2">
                <div>
                    {% if item.body.original_price and item.body.original_price > item.body.price %}
                    <span class="text-xs text-gray-400 line-through">${{ "{:,.0f}".format(item.body.original_price) }}</span>
                    <span class="text-lg font-bold text-green-600">${{ "{:,.0f}".format(item.body.price) }}</span>
                    <span class="text-xs text-green-600">(-{{ "%.0f"|format((1 - item.body.price / item.body.original_price) * 100) }}%)</span>
                    {% else %}
                    <span class="text-xl font-bold text-gray-800">${{ "{:,.0f}".format(item.body.price) }}</span>
                    {% endif %}
                </div>
                <span class="text-sm text-gray-500">Stock: {{ item.body.available_quantity }}</span>
            </div>
            {% set inv = inventory_map.get(item.body.id) if inventory_map is defined else None %}
            {% if inv %}
            <div class="flex gap-2 mb-3 text-xs">
                <span class="px-2 py-1 rounded {{ 'bg-green-100 text-green-700' if inv.MTY > 0 else 'bg-red-100 text-red-600' }}">
                    MTY: <strong>{{ inv.MTY }}</strong>
                </span>
                <span class="px-2 py-1 rounded {{ 'bg-green-100 text-green-700' if inv.CDMX > 0 else 'bg-red-100 text-red-600' }}">
                    CDMX: <strong>{{ inv.CDMX }}</strong>
                </span>
            </div>
            {% endif %}

            <!-- Edicion rapida -->
            <div class="space-y-2">
                <div class="flex gap-2">
                    <input type="number" step="0.01" value="{{ item.body.price }}"
                           id="price-{{ item.body.id }}"
                           class="w-full border rounded px-2 py-1 text-sm">
                    <button hx-put="/api/items/{{ item.body.id }}/price"
                            hx-include="#price-{{ item.body.id }}"
                            hx-vals='js:{"price": parseFloat(document.getElementById("price-{{ item.body.id }}").value)}'
                            hx-swap="none"
                            class="bg-yellow-400 px-3 py-1 rounded text-sm hover:bg-yellow-500">
                        $
                    </button>
                </div>
                <div class="flex gap-2">
                    <input type="number" value="{{ item.body.available_quantity }}"
                           id="stock-{{ item.body.id }}"
                           class="w-full border rounded px-2 py-1 text-sm">
                    <button hx-put="/api/items/{{ item.body.id }}/stock"
                            hx-include="#stock-{{ item.body.id }}"
                            hx-vals='js:{"quantity": parseInt(document.getElementById("stock-{{ item.body.id }}").value)}'
                            hx-swap="none"
                            class="bg-blue-500 text-white px-3 py-1 rounded text-sm hover:bg-blue-600">
                        #
                    </button>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
    {% else %}
    <div class="col-span-full text-center py-8 text-gray-500">
        No hay productos con este estado
    </div>
    {% endfor %}
</div>

{% if paging %}
<div class="mt-6 flex justify-center gap-2">
    {% if offset > 0 %}
    <button hx-get="/partials/items-grid?offset={{ offset - limit }}&status={{ status }}"
            hx-target="#items-grid"
            class="px-4 py-2 border rounded hover:bg-gray-100">
        Anterior
    </button>
    {% endif %}
    {% if offset + limit < paging.total %}
    <button hx-get="/partials/items-grid?offset={{ offset + limit }}&status={{ status }}"
            hx-target="#items-grid"
            class="px-4 py-2 border rounded hover:bg-gray-100">
        Siguiente
    </button>
    {% endif %}
</div>
{% endif %}
